<button class="btn btn-primary" (click)="onCreate()">Create New Survey</button>

<table class="table table-bordered mt-3">
    <caption>Surveys</caption>
    <thead class="thead-light">
        <tr>
            <th scope="col">Title</th>
            <th scope="col">Type</th>
            <th scope="col">Cycle Date</th>
            <th scope="col">End Date</th>
            <th scope="col">Status</th>
            <th scope="col">Edit</th>
            <th scope="col">More Actions</th>
        </tr>
    </thead>
    <tbody>
        <ng-container *ngIf="loading">
            <tr>
                <td colspan="7">Loading...</td>
            </tr>
        </ng-container>
        <ng-container *ngIf="!loading">
            <tr *ngFor="let survey of surveys">
                <td>{{survey.title}}</td>
                <td>{{surveyTypes[survey.type]}}</td>
                <td>{{formatDate(survey.startDate)}}</td>
                <td>{{formatDate(survey.endDate)}}</td>
                <td>
                    <span *ngIf="survey.isActive">Active</span>
                    <span *ngIf="!survey.isActive">Inactive</span>
                </td>
                <td><a href="javascript:void(0)" (click)="onEdit(survey.id)">Edit</a></td>
                <td>
                    <div class="dropdown">
                        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                            More Actions
                        </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" routerLink="questions-edit/{{survey.id}}">Questions Edit</a>
                            <a class="dropdown-item" href="javascript:void(0)" (click)="onCopy(survey.id)">Copy</a>
                            <a class="dropdown-item" routerLink="responses/{{survey.id}}">Responses</a>
                            <a *ngIf="isTester && survey.type == 0" class="dropdown-item" href="javascript:void(0)" (click)="onDelete(survey.id)">Delete</a>
                        </div>
                    </div>
                </td>
            </tr>
        </ng-container>
    </tbody>
</table>

<div class="modal fade" id="create-or-edit">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <strong class="modal-title">{{modalTitle}}</strong>
            </div>
            <div class="modal-body">
                <form class="needs-validation" *ngIf="survey" novalidate>
                    <div class="form-group">
                        <label for="title-field">Title:</label>
                        <input type="text" id="title-field" [(ngModel)]="survey.title" name="title" class="form-control" placeholder="Enter Survey Title" maxlength="100" required>
                        <div class="invalid-feedback">Please enter Survey Title.</div>
                    </div>
                    <div class="form-group">
                        <label for="description-field">Description:</label>
                        <input type="text" id="description-field" [(ngModel)]="survey.description" name="description" class="form-control" placeholder="Enter Survey Description" maxlength="500">
                    </div>
                    <div class="form-group">
                        <label for="header-field">Header Information:</label>
                        <textarea id="header-field" [(ngModel)]="survey.informationText" name="description" class="form-control" rows="2" cols="120" maxlength="500"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="type-field">Type:</label>
                        <select id="type-field" [(ngModel)]="survey.type" name="type" class="form-control" placeholder="Select Survey Type" required>
                            <option value="0">CUDC</option>
                            <option value="1">CAT</option>
                            <option value="2">SE</option>
                            <option value="3">DOS</option>
                        </select>
                        <div class="invalid-feedback">Please select Survey Type.</div>
                    </div>
                    <div class="form-group">
                        <label for="start-date-field">Cycle Date:</label>
                        <input type="text" id="start-date-field" value="{{formatDate(survey.startDate)}}" class="form-control" placeholder="Enter Start Date">
                    </div>
                    <div class="form-group">
                        <label for="end-date-field">End Date:</label>
                        <input type="text" id="end-date-field" value="{{formatDate(survey.endDate)}}" class="form-control" placeholder="Enter End Date">
                    </div>
                    <div class="form-group">
                        <label for="status-field">Status:</label>
                        <select id="status-field" [(ngModel)]="survey.isActive" name="isActive" class="form-control" placeholder="Select Survey Status" required>
                            <option value="true">Active</option>
                            <option value="false">Inactive</option>
                        </select>
                        <div class="invalid-feedback">Please select Survey Status.</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" (click)="onCreateOrEdit()">OK</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal" (click)="onCancel()">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="copy-confirmation">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <img src="assets/warning.png" alt="Warning"> Are you sure you want to copy this survey?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal" (click)="onCopyConfirmation()">OK</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="delete-confirmation">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <img src="assets/warning.png" alt="Warning"> Are you sure you want to delete this survey?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal" (click)="onDeleteConfirmation()">OK</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="delete-cancel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <img src="assets/warning.png" alt="Warning"> You can't delete this survey because you are not its owner.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Spinner modal -->
<div class="modal fade" id="spinner">
    <div class="modal-dialog">
        <div class="d-flex justify-content-center">
            <div class="spinner-border text-primary" role="status"></div>
        </div>
    </div>
</div>
