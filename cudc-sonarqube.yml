trigger: none
pr: none

schedules:
- cron: '0 3 * * *'
  displayName: 'Nightly SonarQube Scan'
  branches:
    include:
    - main
  always: true

resources:
  repositories:
  - repository: templates
    type: git
    name: ITSS TO1\PipelineTemplates
    ref: 'refs/heads/main'

variables:
  majorVersion: 3
  minorVersion: 9
  productName: 'CUDC'

name: $(majorVersion).$(minorVersion).$(date:yy)$(DayOfYear)$(rev:.r)

jobs:
  - template: DotNet/job-sonarqube-scan-dotnet.yml@templates
    parameters:
      productName: '$(productName)'
      sonarQubeProjectKey: '$(productName)'
      pathToRestore: 'CUDC/CUDC.sln'
      projectsToBuild:
        - path: 'CUDC/CUDC.Api/CUDC.Api.csproj'
          buildPlatform: 'x64'
          buildConfiguration: 'Release'
        - path: 'CUDC/CUDC.Web/CUDC.Web.csproj'
          buildPlatform: 'x64'
          buildConfiguration: 'Release'

  - template: NPM/job-sonarqube-scan-npm.yml@templates
    parameters:
      productName: '$(productName)_UI'
      sonarQubeProjectKey: '$(productName)_UI'
      workingDirectory: 'CUDC/CUDC.Client'
      useCleanInstall: true
      auditLevel: 'none'
      buildConfigurations:
        - configuration: 'build'